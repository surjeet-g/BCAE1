<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Screens/TabScreens/Dashboard.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Screens/TabScreens/Dashboard.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect, useCallback, useRef } from "react";
import {
  TouchableOpacity,
  StyleSheet,
  Text,
  Dimensions,
  View,
  Image,
  FlatList,
  Pressable,
  Platform,
  SafeAreaView,
  ActivityIndicator,
  Alert,
} from "react-native";
import RNLocation from "react-native-location";
import { useDispatch, useSelector } from "react-redux";

const { height } = Dimensions.get("screen");
import {
  getMyDashboardData,
  resetMyDashboardData,
} from "../../Redux/MyDashboardDispatcher";
import {
  spacing,
  fontSizes,
  color,
  buttonType,
  buttonSize,
  bottomBarHeight,
} from "../../Utilities/Constants/Constant";
import { strings } from "../../Utilities/Language/index";
import MapView, { PROVIDER_GOOGLE, Marker, Callout } from "react-native-maps";
import { CustomActivityIndicator } from "../../Components/CustomActivityIndicator";
import Header from "./Component/Header";
import { saveToken } from "../../Storage/token";
import Moment from "moment";
import LoadingAnimation from "../../Components/LoadingAnimation";
import { logoutUser } from "../../Redux/LogoutDispatcher";
/**
 * Homescreen : customer can able see the master interaction inside mapview 
 * @namespace Homescreen  
 */
const Dashboard = ({ route, navigation }) => {
  let mapPlotedCoordinates = [];
  let profile = useSelector((state) => state.profile);
  let dashboard = useSelector((state) => state.myDashboardData);
  const [markerSelected, setMarkerSelected] = useState(false);
  const [highlightedIndex, setHighlightedIndex] = useState(0);
  const [myscreenmae, setscreenname] = useState("Home");

  const [currentCoordinate, setCurrentCoordinate] = useState({
    latitude: 4.5353,
    longitude: 114.7277,
  });

  const [loadingMessage, setLoadingString] = useState(strings.please_wait);

  const mapRef = useRef(null);
  //onst [otpTimer, setOtpTimer] = useState(OTP_TIMER);
  //const OTP_TIMER = 3;

  const latitudeDelta = 0.025;
  const longitudeDelta = 0.025;

  const dispatch = useDispatch([
    getMyDashboardData,
    resetMyDashboardData,
    logoutUser,
  ]);

  /**
  * Fetch Master interaction API 
  * @memberOf Homescreen
  * @param  {number} page reference for which page (pagination)
  */
  const fetchMyDashboardData = (page) => {
    // console.log("from fetch my dashboard", page, dashboard.noData);
    dispatch(getMyDashboardData(page));
  };

  const noData = dashboard?.noData;

  useEffect(() => {
    fetchMyDashboardData(0);
  }, []);
  /**
  * Set google map marker pointed by using API response data
  * @memberOf Homescreen
  * @param  {number} page reference for which page (pagination)
  */
  const Markers = React.memo(({ data }) => {
    return data.map((marker, index) => {
      const dom = (
        &lt;Marker
          key={marker.intxnId}
          onPress={() => onMarkerPressed(marker, index)}
          coordinate={{
            latitude: marker?.latitude,
            longitude: marker?.longitude,
          }}
          //coordinate={{latitude: 4.931796, longitude: 114.836504}}
          title={marker.address}
        >
          &lt;TouchableOpacity onPress={() => setMarkerSelected(true)}>
            {markerAddedWithRemoveDuplication(
              {
                latitude: marker?.latitude,
                longitude: marker?.longitude,
              },
              index
            )}
          &lt;/TouchableOpacity>

          &lt;Callout tooltip={true} width={210} style={styles.ticketItem}>
            &lt;View>
              &lt;Text style={[styles.textBase, styles.description]}>
                {getAddressFromResponse(marker)}
              &lt;/Text>
            &lt;/View>
          &lt;/Callout>
        &lt;/Marker>
      );
      mapPlotedCoordinates.push({
        latitude: marker?.latitude,
        longitude: marker?.longitude,
      });
      return dom;
    });
  });

  //checking section timeout
  const [sessionPopupDisable, setSessionPopupDisable] = useState(true);

  useEffect(() => {
    if (
      !dashboard?.initMyDashboard &amp;&amp;
      sessionPopupDisable &amp;&amp;
      dashboard?.myDashboardData?.errorCode == "401"
    ) {
      setSessionPopupDisable(false);

      sessionOut();
    }
  }, [dashboard]);

  const LoadMoreRandomData = () => {
    if (!dashboard?.noData) fetchMyDashboardData(dashboard.page + 1);
  };

  const onMarkerPressed = () => {
    setMarkerSelected(true);
  };
  /**
  * The marker point navigates to first master interaction location
  * @memberOf Homescreen
  */
  const animateToRegion = async () => {
    mapRef.current.animateToRegion(
      {
        latitude:
          dashboard?.myDashboardData[0]?.latitude || currentCoordinate.latitude,
        longitude:
          dashboard?.myDashboardData[0]?.longitude ||
          currentCoordinate.longitude,
        latitudeDelta: latitudeDelta,
        longitudeDelta: longitudeDelta,
      },
      1000
    );
  };

  const sessionOut = async () =>
    Alert.alert(strings.attention, strings.session_expired, [
      {
        text: strings.ok,
        onPress: async () => {
          dispatch(logoutUser(navigation, profile?.savedProfileData?.userId));
        },
      },
    ]);

  const CheckForGPSEnablement = () => {
    return new Promise((resolve) => {
      RNLocation.configure({
        distanceFilter: 100, // Meters
        desiredAccuracy: {
          ios: "best",
          android: "balancedPowerAccuracy",
        },
        // Android only
        androidProvider: "auto",
        interval: 5000, // Milliseconds
        fastestInterval: 10000, // Milliseconds
        maxWaitTime: 5000, // Milliseconds
        // iOS Only
        activityType: "other",
        allowsBackgroundLocationUpdates: false,
        headingFilter: 1, // Degrees
        headingOrientation: "portrait",
        pausesLocationUpdatesAutomatically: false,
        showsBackgroundLocationIndicator: false,
      })
        .then((x) => {
          console.log({ x });
          resolve(true);
        })
        .catch((err) => {
          console.log({ err });
          resolve(false);
        });
    });
  };
  /**
  * Formatting address from address Object
  * @memberOf Homescreen
  * @param  {Object} data adddress Object
  */
  const getAddressFromResponse = (data) => {
    let addressString = "";
    if (data.houseNo) {
      addressString += data.houseNo + ",";
    }
    if (data.block) {
      addressString += data.block + ",";
    }
    if (data.buildingName) {
      addressString += data.buildingName + ",";
    }
    if (data.street) {
      addressString += data.street + ",";
    }
    if (data.town) {
      addressString += data.town + ",";
    }
    if (data.city) {
      addressString += data.city + ",";
    }
    if (data.district) {
      addressString += data.district + ",";
    }
    if (data.state) {
      addressString += data.state + ",";
    }
    if (data.country) {
      addressString += data.country + ",";
    } else {
      addressString += "Brunei";
    }

    if (data.postCode) {
      addressString += " " + data.postCode;
    }
    return addressString;
  };
  const markerAddedWithRemoveDuplication = (marker, index) => {
    const matchedCoord = mapPlotedCoordinates.filter(
      (mark) =>
        mark.latitude == marker.latitude &amp;&amp; mark.longitude == marker.longitude
    );

    const icon =
      index == highlightedIndex
        ? require("../../Assets/icons/ic_overlay_highlighted.png")
        : require("../../Assets/icons/ic_overlay_normal_ios.png");
    return (
      &lt;View>
        &lt;Image source={icon} style={styles.icon} resizeMode="contain" />
      &lt;/View>
    );
  };
  const onScroll = useCallback(
    (event) => {
      const slideSize = 330;
      const index = event.nativeEvent.contentOffset.x / slideSize;
      const roundIndex = Math.round(index);
      if (mapRef) {
        mapRef?.current?.animateToRegion(
          {
            latitude: dashboard?.myDashboardData[roundIndex]?.latitude,
            longitude: dashboard?.myDashboardData[roundIndex]?.longitude,
            latitudeDelta: latitudeDelta,
            longitudeDelta: longitudeDelta,
          },
          100
        );
      }
      setHighlightedIndex(roundIndex);
      // console.log(
      //   "event.nativeEvent.contentOffset.x : " +
      //     event.nativeEvent.contentOffset.x +
      //     "slideSize : " +
      //     slideSize +
      //     "roundIndex:",
      //   roundIndex
      // );
    },
    [dashboard]
  );
  /**
* Give UI for Master interction inside Flatlist
* @memberOf CreateComplaints
* @param  {string} title title of interaction
* @param  {boolean} type type of interaction (master interaction or interation)
* @param  {number} ticketNo ticketNo of interaction
* @param  {string} date date of interaction
* @param  {string} address address of interaction
*/
  const ListItem = ({ title, type, status, ticketNo, date, address }) => {
    function OnClickTicketItem() { }

    return (
      &lt;Pressable
        onPress={OnClickTicketItem}
        style={({ pressed }) => pressed &amp;&amp; styles.pressed}
      >
        &lt;View style={[styles.ticketItem]}>
          &lt;View style={{ flexDirection: "column" }}>
            &lt;View style={styles.ticketItemHeading}>
              {type == "Master Interaction" &amp;&amp; (
                &lt;Text
                  numberOfLines={1}
                  style={[styles.textBase, styles.description]}
                >
                  Master Interaction
                &lt;/Text>
              )}
              {type != "Master Interaction" &amp;&amp; (
                &lt;Text style={[styles.textBase, styles.description]}>
                  My Interaction
                &lt;/Text>
              )}
            &lt;/View>
            &lt;View style={{ flexDirection: "column", marginBottom: 10 }}>
              &lt;View style={[styles.box1]}>
                &lt;View style={{ flex: 7 }}>
                  &lt;Text style={[styles.ticketNo]}>{ticketNo}&lt;/Text>
                &lt;/View>
                &lt;View style={{ flex: 3, alignItems: "flex-end" }}>
                  &lt;Text style={[styles.date]}>
                    {Moment(date).format("DD MMM")}
                  &lt;/Text>
                &lt;/View>
              &lt;/View>

              &lt;Text numberOfLines={1} style={[styles.title]}>
                {title}
              &lt;/Text>
            &lt;/View>
            &lt;View style={{ flexDirection: "row" }}>
              &lt;View style={[styles.box1loc]}>
                &lt;Image
                  source={require("../../Assets/icons/ic_overlay_normal.png")}
                  style={styles.icon}
                />
              &lt;/View>
              &lt;View style={[styles.box3add]}>
                &lt;Text style={[styles.date, []]}>{address}&lt;/Text>
              &lt;/View>
            &lt;/View>
          &lt;/View>
        &lt;/View>
      &lt;/Pressable>
    );
  };
  const loaderDom = () => {
    return (
      &lt;View
        style={{
          alignItems: "center",
          justifyContent: "center",
          marginTop: 200,
        }}
      >
        &lt;LoadingAnimation>&lt;/LoadingAnimation>
        &lt;Text style={styles.emptyList}>{loadingMessage}&lt;/Text>
      &lt;/View>
    );
  };

  return (
    &lt;SafeAreaView style={styles.container}>
      {dashboard?.initMyDashboard &amp;&amp; loaderDom(loadingMessage)}
      {!dashboard.initMyDashboard &amp;&amp; !dashboard?.isMyDashboardError &amp;&amp; (
        &lt;MapView
          showsMyLocationButton={true}
          provider={PROVIDER_GOOGLE}
          ref={mapRef}
          showsUserLocation={true}
          followsUserLocation={true}
          style={styles.map}
          onMapReady={animateToRegion}
          initialRegion={{
            latitude:
              dashboard?.myDashboardData[0]?.latitude ||
              currentCoordinate.latitude,
            longitude:
              dashboard?.myDashboardData[0]?.longitude ||
              currentCoordinate.longitude,
            latitudeDelta: latitudeDelta,
            longitudeDelta: longitudeDelta,
          }}
        >
          {!dashboard?.initMyDashboard &amp;&amp;
            dashboard?.myDashboardData?.length > 0 &amp;&amp; (
              &lt;Markers data={dashboard?.myDashboardData} />
            )}
        &lt;/MapView>
      )}
      &lt;View>
        {(!dashboard?.initMyDashboard &amp;&amp; dashboard?.isMyDashboardError) ||
          (!dashboard?.initMyDashboard &amp;&amp; dashboard?.myDashboardData &amp;&amp; (
            &lt;Header
              navigation={navigation}
              Text={myscreenmae}
              backIconVisibility={false}
              transparent={true}
              bcae={true}
              rightIconsVisibility={true}
            >&lt;/Header>
          ))}

        {dashboard?.initMyDashboardBackground &amp;&amp; (
          &lt;Text>data fetched in background&lt;/Text>
        )}
      &lt;/View>
      {!dashboard?.initMyDashboard &amp;&amp;
        dashboard?.isMyDashboardError &amp;&amp;
        dashboard?.myDashboardData?.errorCode === "10001" &amp;&amp; (
          &lt;View style={{ alignItems: "center" }}>
            &lt;Text style={styles.emptyList}>{strings.no_internet}&lt;/Text>
          &lt;/View>
        )}
      {!dashboard?.initMyDashboard &amp;&amp; dashboard?.myDashboardData.length > 0 &amp;&amp; (
        &lt;View style={[{ height: "auto" }, styles.bottomView]}>
          &lt;FlatList
            contentContainerStyle={{ padding: 20 }}
            horizontal
            onScroll={onScroll}
            data={dashboard?.myDashboardData}
            onEndReachedThreshold={0.5}
            onEndReached={LoadMoreRandomData}
            renderItem={({ item }, data) => {
              return (
                &lt;ListItem
                  title={
                    item.serviceTypeDesc
                      ? item.serviceTypeDesc
                      : item.ticketTypeDesc
                  }
                  type={item.intxnType}
                  status={item.currStatusDesc}
                  ticketNo={item.intxnId}
                  date={item.createdAt}
                  address={getAddressFromResponse(item)}
                />
              );
            }}
            showsHorizontalScrollIndicator={false}
            ListFooterComponent={() => {
              if (noData) {
                return null;
              }
              return (
                &lt;View style={{ marginBottom: spacing.HEIGHT_30 }}>
                  &lt;ActivityIndicator size="large" />
                &lt;/View>
              );
            }}
          />
        &lt;/View>
      )}

      {!dashboard?.initMyDashboard &amp;&amp; dashboard?.myDashboardData.length &lt; 1 &amp;&amp; (
        &lt;View
          style={{
            alignItems: "center",
            justifyContent: "center",
            marginTop: 120,
          }}
        >
          &lt;Text style={[styles.textBase, styles.description]}>
            {strings.empty_ticket_list}
          &lt;/Text>
        &lt;/View>
      )}
    &lt;/SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    marginBottom: bottomBarHeight,
    backgroundColor: color.WHITE,
  },
  bottomView: {
    flex: 1,
    // marginLeft: 20,
    width: "100%",
    position: "absolute",
    bottom: height / 12,
  },

  map: {
    marginTop: Platform.OS === "android" ? 50 : height / 14,
    ...StyleSheet.absoluteFillObject,
    // marginBottom: Platform.OS === "android" ? 0 : height / 5,
  },
  ticketItem: {
    width: 320,
    padding: 10,
    marginRight: 35,
    backgroundColor: "white",
    flexDirection: "row",
    justifyContent: "center",
    borderRadius: 10,
    elevation: 3,
    shadowColor: "blue",
    shadowRadius: 1,
    shadowOffset: { width: 1, height: 1 },
    shadowOpacity: 0.4,
  },
  ticketItemHeading: {
    minWidth: "95%",
    marginVertical: 4,
    backgroundColor: "white",
    flexDirection: "row",
  },
  textBase: {
    color: color.BCAE_PRIMARY,
  },
  description: {
    fontSize: 20,
    fontWeight: "400",
  },
  ticketNo: {
    fontSize: 16,
    fontWeight: "500",
    color: "#090A0A",
  },
  title: {
    fontSize: 14,
    fontWeight: "400",
    color: "#375B9E",
  },
  amountContainer: {
    paddingHorizontal: 12,
    paddingVertical: 4,
    backgroundColor: "white",
    justifyContent: "center",
    alignItems: "center",
    borderRadius: 4,
    minWidth: 80,
  },
  box1: {
    flexDirection: "row",
  },
  box3: {
    flex: 1,
    alignItems: "flex-end",
    justifyContent: "flex-start",
    height: 50,
  },
  box1loc: {
    height: 50,
  },
  box3add: {
    flex: 4,
    alignItems: "flex-end",
    justifyContent: "flex-start",
    height: 50,
  },
  date: {
    fontSize: 14,
    fontWeight: "400",
    color: "#7D7D7D",
  },
  searchIcon: {
    width: spacing.WIDTH_21,
    height: spacing.WIDTH_21,
  },
  rightArrow: {
    alignItems: "center",
    justifyContent: "center",
  },
  emptyList: {
    fontSize: 20,
    color: color.BCAE_PRIMARY,
  },
  icon: {
    width: 30,
    height: 35,
  },
});
export default Dashboard;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="Chat.html">Chat</a></li><li><a href="CreateComplaints.html">CreateComplaints</a></li><li><a href="CreateEquiry.html">CreateEquiry</a></li><li><a href="Homescreen.html">Homescreen</a></li><li><a href="Login.html">Login</a></li><li><a href="Register.html">Register</a></li><li><a href="Splash.html">Splash</a></li><li><a href="TicketDetails.html">TicketDetails</a></li><li><a href="TicketListing.html">TicketListing</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Button">Button</a></li><li><a href="global.html#CustomActivityIndicator">CustomActivityIndicator</a></li><li><a href="global.html#EditText">EditText</a></li><li><a href="global.html#ShareDoc">ShareDoc</a></li><li><a href="global.html#TextBoxWithCTA">TextBoxWithCTA</a></li><li><a href="global.html#TextBoxWithCTAEmail">TextBoxWithCTAEmail</a></li><li><a href="global.html#ToastTemplete">ToastTemplete</a></li><li><a href="global.html#ToggleButton">ToggleButton</a></li><li><a href="global.html#downloadFile">downloadFile</a></li><li><a href="global.html#getFcmDeviceId">getFcmDeviceId</a></li><li><a href="global.html#notificationListener">notificationListener</a></li><li><a href="global.html#permission">permission</a></li><li><a href="global.html#requestUserPermission">requestUserPermission</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Mon Jul 31 2023 10:47:06 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
